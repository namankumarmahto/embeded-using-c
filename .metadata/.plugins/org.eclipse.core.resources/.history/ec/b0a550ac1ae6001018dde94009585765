//write a program to implement a mode counter
#include <stdint.h>

// Base addresses
#define RCC_Base     0x40023800
#define GPIOA_Base   0x40020000
#define GPIOC_Base   0x40020800

// Declaration of pointers
uint32_t *AHB1ENR      = (uint32_t *)(RCC_Base + 0x30);
uint32_t *GPIOC_Moder = (uint32_t *)(GPIOC_Base + 0x00);
uint32_t *GPIOC_IDR   = (uint32_t *)(GPIOC_Base + 0x10);
uint32_t *GPIOC_ODR   = (uint32_t *)(GPIOC_Base + 0x14);

// function prototypes
void GPIO_Init(void);
void unpack(uint8_t);
void bit_porting(void);

// Global declarations
uint8_t b0 = 0, b1 = 0, b2 = 0, b3 = 0;
uint8_t mod = 16;
uint8_t count_put = 0;   // 0 → UP counter, 1 → DOWN counter

int main(void)
{
    uint32_t count = 0;
    GPIO_Init();

    while (1)
    {
        if (!(*GPIOC_IDR & (1 << 13)))
        {
            while (!(*GPIOC_IDR & (1 << 13)));

            /* -------- MODE SELECTION -------- */
            if (count_put == 0)       // UP counter
            {
                if (count < (mod - 1))
                    count++;
                else
                    count = 0;
            }
            else                      // DOWN counter
            {
                if (count > 0)
                    count--;
                else
                    count = mod - 1;
            }

            unpack(count);
            bit_porting();
        }
    }
}

// bit porting function
void bit_porting(void)
{
    *GPIOC_ODR = (b0 << 0) | (b1 << 1) | (b2 << 2) | (b3 << 3);
}

// GPIO initialization function
void GPIO_Init(void)
{
    *AHB1ENR |= (1 << 2);        // Enable GPIOC clock

    *GPIOC_Moder &= ~(3 << 26);  // PC13 input
    *GPIOC_Moder &= ~(3 << 0);   // Clear PC0–PC3
    *GPIOC_Moder |=  (1 << 0) | (1 << 2) | (1 << 4) | (1 << 6); // PC0–PC3 output
}

// Unpacking digits into bits
void unpack(uint8_t val)
{
    b0 = (val >> 0) & 1;
    b1 = (val >> 1) & 1;
    b2 = (val >> 2) & 1;
    b3 = (val >> 3) & 1;
}
