#include "stm32f4xx.h"

/* -------- GPIO Init (LED on PA5) -------- */
void GPIO_Init(void)
{
    RCC->AHB1ENR |= (1 << 0);        // Enable clock for GPIOA
    GPIOA->MODER |= (1 << 10);       // PA5 as output (01)
}

/* -------- Timer2 Init -------- */
void Timer2_Init(void)
{
    RCC->APB1ENR |= (1 << 0);        // Enable TIM2 clock

    TIM2->PSC = 16000;               // 16 MHz / (16000 + 1) ≈ 1 kHz
    TIM2->ARR = 1000 - 1;            // 1000 ticks ≈ 1 second
    TIM2->CNT = 0;                   // Reset counter

    TIM2->CR1 |= (1 << 0);           // Start timer (CEN = 1)
}

/* -------- Delay using overflow flag -------- */
void Timer_Delay(void)
{
    while(!(TIM2->SR & (1 << 0)));   // Wait for UIF flag
    TIM2->SR &= ~(1 << 0);           // Clear UIF flag
}

/* -------- Main -------- */
int main(void)
{
    GPIO_Init();
    Timer2_Init();

    while(1)
    {
        GPIOA->ODR ^= (1 << 5);      // Toggle LED
        Timer_Delay();               // ~1 second delay
    }
}
