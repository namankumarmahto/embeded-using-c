//write a program to implement a mode counter
#include <stdint.h>

// Base addresses
#define RCC_Base     0x40023800
#define GPIOA_Base   0x40020000
#define GPIOC_Base   0x40020800

// register pointers
uint32_t *AHB1ENR     = (uint32_t *)(RCC_Base + 0x30);
uint32_t *GPIOC_MODER = (uint32_t *)(GPIOC_Base + 0x00);
uint32_t *GPIOC_IDR   = (uint32_t *)(GPIOC_Base + 0x10);
uint32_t *GPIOC_ODR   = (uint32_t *)(GPIOC_Base + 0x14);
uint32_t *GPIOA_MODER = (uint32_t *)(GPIOA_Base + 0x00);
uint32_t *GPIOA_ODR   = (uint32_t *)(GPIOA_Base + 0x14);

// function prototypes
void GPIO_Init(void);
void unpack(uint8_t);
void bit_porting(void);

// Global declarations
uint8_t b0 = 0, b1 = 0, b2 = 0, b3 = 0;
uint8_t mod = 16;

int main(void)
{
    uint32_t count = 0;
    GPIO_Init();

    /* Loop forever */
    while (1)
    {
        if (!(*GPIOC_IDR & (1 << 13)))
        {
            while (!(*GPIOC_IDR & (1 << 13)));

            if (count < (mod - 1))
            {
                count++;
            }
            else
            {
                count = 0;
            }

            unpack(count);
            bit_porting();
        }
    }
}
//GPIO initialization function
void GPIO_init()
{
	*AHB1ENR |= (1<<2);
	*GPIOC_Moder &= ~(1<<26);
	*GPIOC_Moder &= ~(1<<27);
	*GPIOC_Moder = (1<<0) | (1<<2) | (1<<4) | (1<<6);
}

//Unpacking digits into bits
void unpack(uint8_t val)
{
	b0 = val & 0x1;
	b1 = val & 0x2;
	b2 = val & 0x4;
	b3 = val & 0x8;
}

