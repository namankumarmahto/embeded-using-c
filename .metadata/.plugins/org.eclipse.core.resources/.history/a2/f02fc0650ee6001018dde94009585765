//write a program to implement a mode counter
#include <stdint.h>

// Base addresses
#define RCC_Base     0x40023800
#define GPIOA_Base   0x40020000
#define GPIOC_Base   0x40020800

// Declaration of pointers (FIXED)
uint32_t *AHB1ENR      = (uint32_t *)(RCC_Base + 0x30);
uint32_t *GPIOC_Moder = (uint32_t *)(GPIOC_Base + 0x00);
uint32_t *GPIOC_IDR   = (uint32_t *)(GPIOC_Base + 0x10);
uint32_t *GPIOC_ODR   = (uint32_t *)(GPIOC_Base + 0x14);

// function prototypes
void GPIO_Init(void);
void unpack(uint8_t);
void bit_porting(void);

// Global declarations
uint8_t b0 = 0, b1 = 0, b2 = 0, b3 = 0;
uint8_t mod = 16;

int main(void)
{
    uint32_t count = 0;
    GPIO_Init();

    while (1)
    {
        if (!(*GPIOC_IDR & (1 << 13)))
        {
            while (!(*GPIOC_IDR & (1 << 13)));

            if (count < (mod - 1))
                count++;
            else
                count = 0;

            unpack(count);
            bit_porting();
        }
    }
}

// bit porting function
void bit_porting(void)
{
    *GPIOC_ODR = (b0 << 0) | (b1 << 1) | (b2 << 2) | (b3 << 3);
}

// GPIO initialization function (NAME FIXED)
void GPIO_Init(void)
{
    *AHB1ENR |= (1 << 2);        // Enable GPIOC clock

    *GPIOC_Moder &= ~(3 << 26);  // PC13 input
    *GPIOC_Moder &= ~(3 << 0);   // Clear PC0–PC3
    *GPIOC_Moder |=  (1 << 0) | (1 << 2) | (1 << 4) | (1 << 6); // PC0–PC3 output
}

// Unpacking digits into bits (FIXED)
void unpack(uint8_t val)
{
    b0 = (val >> 0) & 1;
    b1 = (val >> 1) & 1;
    b2 = (val >> 2) & 1;
    b3 = (val >> 3) & 1;
}
